# audit/code-audit-cup-playoff-bracket

**–î–∞—Ç–∞:** 2025-11-28  
**–ó–∞–¥–∞—á–∞:** –£–ª—É—á—à–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Å–µ–∑–æ–Ω–∞ –∏ –ª–æ–≥–∏–∫–∏ –∫—É–±–∫–∞ —Å –≥—Ä—É–ø–ø–∞–º–∏ + –ø–ª–µ–π-–æ—Ñ—Ñ  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:** VSCode Agent v1.1

## 1. –ü–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- "seasonAutomation playoff bracket group stage"
- "GROUP_SINGLE_ROUND_PLAYOFF seriesFormat"
- "createGroupStageSchedule qualifyCount"
- "maybeCreateNextPlayoffStage bracket"
- "determineMatchWinnerClubId penalty shootout"

## 2. –ü—Ä–æ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—É—Ç–∏
- `backend/src/services/seasonAutomation.ts`
- `backend/src/services/matchAggregation.ts`
- `backend/src/routes/adminRoutes.ts`
- `backend/src/routes/bracketRoutes.ts`
- `admin/src/components/tabs/MatchesTab.tsx`
- `prisma/schema.prisma`

## 3. –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
- `seasonAutomation.ts` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Å–µ–∑–æ–Ω–∞, —Å–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø, –ø–ª–µ–π-–æ—Ñ—Ñ
- `matchAggregation.ts` ‚Äî –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–∏ —Å—Ç–∞–¥–∏–π –ø–ª–µ–π-–æ—Ñ—Ñ, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è —Å —É—á–µ—Ç–æ–º –ø–µ–Ω–∞–ª—å—Ç–∏
- `adminRoutes.ts` ‚Äî API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ–∑–æ–Ω–æ–≤
- `MatchesTab.tsx` ‚Äî UI –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Å–µ–∑–æ–Ω–∞ –≤ –∞–¥–º–∏–Ω–∫–µ

## 4. –†–µ—à–µ–Ω–∏–µ
–ê–¥–∞–ø—Ç–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤–æ–π —ç—Ç–∞–ª–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –∫—É–±–∫–∞:

### –ß—Ç–æ –±—ã–ª–æ (—Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞):
- `qualifyCount` ‚Äî –ø—Ä–æ—Ö–æ–¥—è—Ç –¥–∞–ª—å—à–µ N –ª—É—á—à–∏—Ö –∏–∑ –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã
- –ü–ª–µ–π-–æ—Ñ—Ñ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π bracket –±–µ–∑ —É—á–µ—Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- –ù–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–∞ –ó–æ–ª–æ—Ç–æ–π/–°–µ—Ä–µ–±—Ä—è–Ω—ã–π –∫—É–±–æ–∫

### –ß—Ç–æ —Å—Ç–∞–Ω–µ—Ç (–Ω–æ–≤–∞—è –ª–æ–≥–∏–∫–∞):
- –î–ª—è –∫—É–±–∫–∞ (—Ç–∏–ø `CUP` + —Ñ–æ—Ä–º–∞—Ç `GROUP_SINGLE_ROUND_PLAYOFF`):
  - –í—Å–µ 1-–µ –º–µ—Å—Ç–∞ –≥—Ä—É–ø–ø —Å—Ä–∞–∑—É –≤ 1/4 —Ñ–∏–Ω–∞–ª–∞
  - –í—Å–µ 2-–µ –∏ 3-–µ –º–µ—Å—Ç–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—é
  - –ü–æ–±–µ–¥–∏—Ç–µ–ª–∏ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–¥—É—Ç –≤ 1/4 —Ñ–∏–Ω–∞–ª–∞
  - –ü—Ä–æ–∏–≥—Ä–∞–≤—à–∏–µ 1/4 —Ñ–∏–Ω–∞–ª–∞ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç –°–µ—Ä–µ–±—Ä—è–Ω—ã–π –∫—É–±–æ–∫
  - –ü–æ–±–µ–¥–∏—Ç–µ–ª–∏ 1/4 —Ñ–∏–Ω–∞–ª–∞ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç –ó–æ–ª–æ—Ç–æ–π –∫—É–±–æ–∫
- –í –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Å–µ–∑–æ–Ω–∞ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è:
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä—É–≥–æ–≤ –≤ –≥—Ä—É–ø–ø–µ
  - –î–æ —Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–±–µ–¥ –∏–≥—Ä–∞–µ—Ç—Å—è –ø–ª–µ–π-–æ—Ñ—Ñ

## 5. –≠—Ç–∞–ª–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è 12 –∫–æ–º–∞–Ω–¥ (4 –≥—Ä—É–ø–ø—ã –ø–æ 3)

### –ì—Ä—É–ø–ø–æ–≤–æ–π —ç—Ç–∞–ø
```
–ì—Ä—É–ø–ø–∞ A: A1, A2, A3 (–∫—Ä—É–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞)
–ì—Ä—É–ø–ø–∞ B: B1, B2, B3
–ì—Ä—É–ø–ø–∞ C: C1, C2, C3
–ì—Ä—É–ø–ø–∞ D: D1, D2, D3
```

### –ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è (8 –∫–æ–º–∞–Ω–¥ ‚Äî –≤—Å–µ 2-–µ –∏ 3-–µ –º–µ—Å—Ç–∞)
```
H: C2 vs B3
I: B2 vs C3
G: D2 vs A3
F: A2 vs D3
```

### 1/4 —Ñ–∏–Ω–∞–ª–∞ (8 –∫–æ–º–∞–Ω–¥: 4 –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –≥—Ä—É–ø–ø + 4 –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏)
```
QF1: A1 vs H (–ø–æ–±–µ–¥–∏—Ç–µ–ª—å)
QF2: D1 vs I (–ø–æ–±–µ–¥–∏—Ç–µ–ª—å)
QF3: B1 vs F (–ø–æ–±–µ–¥–∏—Ç–µ–ª—å)
QF4: C1 vs G (–ø–æ–±–µ–¥–∏—Ç–µ–ª—å)
```

### –°–µ—Ä–µ–±—Ä—è–Ω—ã–π –∫—É–±–æ–∫ (–ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏–µ 1/4)
```
–ü–æ–ª—É—Ñ–∏–Ω–∞–ª 1: Loser(QF1) vs Loser(QF2)
–ü–æ–ª—É—Ñ–∏–Ω–∞–ª 2: Loser(QF3) vs Loser(QF4)
–§–∏–Ω–∞–ª –°–µ—Ä–µ–±—Ä—è–Ω–æ–≥–æ: Winner(SF_s1) vs Winner(SF_s2)
3 –º–µ—Å—Ç–æ –°–µ—Ä–µ–±—Ä—è–Ω–æ–≥–æ: Loser(SF_s1) vs Loser(SF_s2)
```

### –ó–æ–ª–æ—Ç–æ–π –∫—É–±–æ–∫ (–ø–æ–±–µ–¥–∏—Ç–µ–ª–∏ 1/4)
```
–ü–æ–ª—É—Ñ–∏–Ω–∞–ª 1: Winner(QF1) vs Winner(QF2)
–ü–æ–ª—É—Ñ–∏–Ω–∞–ª 2: Winner(QF3) vs Winner(QF4)
–§–∏–Ω–∞–ª –ó–æ–ª–æ—Ç–æ–≥–æ: Winner(SF_g1) vs Winner(SF_g2)
3 –º–µ—Å—Ç–æ –ó–æ–ª–æ—Ç–æ–≥–æ: Loser(SF_g1) vs Loser(SF_g2)
```

## 6. –î–æ–ø—É—Å—Ç–∏–º—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≥—Ä—É–ø–ø

| –ì—Ä—É–ø–ø | –ö–æ–º–∞–Ω–¥ –≤ –≥—Ä—É–ø–ø–µ | –í—Å–µ–≥–æ –∫–æ–º–∞–Ω–¥ | –ü—Ä–æ—Ö–æ–¥ –≤ –ø–ª–µ–π-–æ—Ñ—Ñ |
|-------|-----------------|--------------|-------------------|
| 2     | 4               | 8            | –≤—Å–µ 8 –∫–æ–º–∞–Ω–¥ (–ø–æ 4 –∏–∑ –≥—Ä—É–ø–ø—ã) |
| 2     | 5               | 10           | 8 –∫–æ–º–∞–Ω–¥ (–ø–æ 4 –∏–∑ –≥—Ä—É–ø–ø—ã, 5-–µ –º–µ—Å—Ç–∞ –≤—ã–±—ã–≤–∞—é—Ç) |
| 3     | 3               | 9            | 6 –∫–æ–º–∞–Ω–¥ (–ø–æ 2 –∏–∑ –≥—Ä—É–ø–ø—ã) |
| 3     | 4               | 12           | 8 –∫–æ–º–∞–Ω–¥ (–ø–æ 2-3 –∏–∑ –≥—Ä—É–ø–ø—ã) |
| 4     | 3               | 12           | 12 –∫–æ–º–∞–Ω–¥ (–≤—Å–µ –≤ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—é/1/4) |

## 7. –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ë–µ–∫–µ–Ω–¥ ‚Äî –°—Ö–µ–º–∞ –∏ —Ç–∏–ø—ã
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ `Season` –ø–æ–ª—è `groupRounds` –∏ `playoffBestOf`
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∏–ø `CupBracketConfig` –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ç—É—Ä–Ω–∏—Ä–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ `MatchSeries` –ø–æ–ª–µ `bracketType` ('GOLD' | 'SILVER' | 'QUALIFICATION')

### –≠—Ç–∞–ø 2: –ë–µ–∫–µ–Ω–¥ ‚Äî –õ–æ–≥–∏–∫–∞ —ç—Ç–∞–ª–æ–Ω–Ω–æ–π —Å–µ—Ç–∫–∏
- [ ] –°–æ–∑–¥–∞—Ç—å `cupBracketLogic.ts` —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏:
  - `generateQualificationPairs()` ‚Äî —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏
  - `generateQuarterFinalPairs()` ‚Äî —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ 1/4 —Ñ–∏–Ω–∞–ª–∞
  - `progressGoldBracket()` ‚Äî –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—è –∑–æ–ª–æ—Ç–æ–≥–æ –∫—É–±–∫–∞
  - `progressSilverBracket()` ‚Äî –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—è —Å–µ—Ä–µ–±—Ä—è–Ω–æ–≥–æ –∫—É–±–∫–∞
  - `validateCupConfiguration()` ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≥—Ä—É–ø–ø

### –≠—Ç–∞–ø 3: –ë–µ–∫–µ–Ω–¥ ‚Äî –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `seasonAutomation.ts`:
  - –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `groupRounds`, `playoffBestOf` –≤ input
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É –¥–ª—è —Ç–∏–ø–∞ CUP
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `matchAggregation.ts`:
  - –û–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ç–∏–ø —Ç—É—Ä–Ω–∏—Ä–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—é
  - –î–æ–±–∞–≤–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –°–µ—Ä–µ–±—Ä—è–Ω–æ–≥–æ –∫—É–±–∫–∞

### –≠—Ç–∞–ø 4: –ë–µ–∫–µ–Ω–¥ ‚Äî API
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `adminRoutes.ts`:
  - –î–æ–±–∞–≤–∏—Ç—å `groupRounds`, `playoffBestOf` –≤ payload –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `bracketRoutes.ts`:
  - –†–∞–∑–¥–µ–ª–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ Gold/Silver bracket

### –≠—Ç–∞–ø 5: –§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Äî –ê–¥–º–∏–Ω–∫–∞ (—Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `MatchesTab.tsx`:
  - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –¥–ª—è `groupRounds` –∏ `playoffBestOf`
  - –£–±—Ä–∞—Ç—å `qualifyCount` –¥–ª—è –∫—É–±–∫–∞
  - –î–æ–±–∞–≤–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ

### –≠—Ç–∞–ø 6: –§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Äî –ü—É–±–ª–∏—á–Ω–∞—è —á–∞—Å—Ç—å (—Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `PlayoffBracket.tsx`:
  - –†–∞–∑–¥–µ–ª–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ Gold/Silver brackets
  - –î–æ–±–∞–≤–∏—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏

## 8. –ú–µ—Ç—Ä–∏—á–µ—Å–∫–æ–µ –≤–ª–∏—è–Ω–∏–µ
üîµ ‚Äî –£–ª—É—á—à–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –±–µ–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Ç–∏–ø–æ–º LEAGUE
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Ç–∞–¥–∏–π
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ Redis
