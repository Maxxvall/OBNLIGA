# –ê–Ω–∞–ª–∏–∑ –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –ø–æ–¥–ø–∏—Å–∫–∏ Telegram Stars ‚≠ê

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

### –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **Shop –º–æ–¥—É–ª—å** ‚Äî –º–∞–≥–∞–∑–∏–Ω —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤ —Å –∑–∞–∫–∞–∑–∞–º–∏ –≤ —Ä—É–±–ª—è—Ö
- **–ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** ‚Äî `balance` –≤ `AppUser` (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ)
- **–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è** ‚Äî —Å–∏—Å—Ç–µ–º–∞ —É—Ä–æ–≤–Ω–µ–π –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- **–ü–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–æ–º–∞–Ω–¥—ã** ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –º–∞—Ç—á–∞—Ö —á–µ—Ä–µ–∑ Telegram Bot
- **Daily Rewards** ‚Äî –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã (–æ—á–∫–∏)

### –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –ù–µ—Ç —Å–∏—Å—Ç–µ–º—ã –ø—Ä–µ–º–∏—É–º-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
- –ù–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Telegram Payments
- –í–µ—Å—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –æ—Ç–∫—Ä—ã—Ç –±–µ—Å–ø–ª–∞—Ç–Ω–æ

---

## –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –ø–æ–¥–ø–∏—Å–∫–∏

### üå± **ROOKIE** (–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π)
–ë–∞–∑–æ–≤—ã–π –¥–æ—Å—Ç—É–ø –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### üî• **FAN** (–°—Ä–µ–¥–Ω–∏–π) ‚Äî ~49-99‚≠ê/–º–µ—Å—è—Ü
–î–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –±–æ–ª–µ–ª—å—â–∏–∫–æ–≤.

### üèÜ **LEGEND** (–ü—Ä–µ–º–∏—É–º) ‚Äî ~199-299‚≠ê/–º–µ—Å—è—Ü
–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º.

---

## –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –ø–æ —É—Ä–æ–≤–Ω—è–º

### –ë–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (ROOKIE ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω–æ)
| –§—É–Ω–∫—Ü–∏—è | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ |
|---------|-------------|
| –ü—Ä–æ—Å–º–æ—Ç—Ä –º–∞—Ç—á–µ–π –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ | ‚úÖ –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø |
| –¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ | ‚úÖ –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø |
| –ü—Ä–æ—Ñ–∏–ª—å –∏ –±–∞–∑–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | ‚úÖ –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø |
| –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ **1 –∫–æ–º–∞–Ω–¥—É** | ‚úÖ –¢–æ–ª—å–∫–æ –æ–¥–Ω–∞ |
| –ü—Ä–æ–≥–Ω–æ–∑—ã –Ω–∞ –º–∞—Ç—á–∏ | ‚ö†Ô∏è **3 –ø—Ä–æ–≥–Ω–æ–∑–∞ –≤ –Ω–µ–¥–µ–ª—é** |
| –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã | ‚ö†Ô∏è **–ë–∞–∑–æ–≤—ã–µ** (1-5 –æ—á–∫–æ–≤) |
| –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è | ‚ö†Ô∏è **–¢–æ–ª—å–∫–æ –æ–±—â–∏–µ** (5-10 —Ç–∏–ø–æ–≤) |
| –ò—Å—Ç–æ—Ä–∏—è –º–∞—Ç—á–µ–π –∫–æ–º–∞–Ω–¥ | ‚ö†Ô∏è **–ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –º–∞—Ç—á–µ–π** |
| –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –º–∞—Ç—á–∞–º | ‚ö†Ô∏è **3 –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –≤ –¥–µ–Ω—å** |

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (FAN ‚Äî —Å—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å)
| –§—É–Ω–∫—Ü–∏—è | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ |
|---------|-------------|
| –í—Å—ë –∏–∑ ROOKIE | ‚úÖ |
| –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ **5 –∫–æ–º–∞–Ω–¥** | ‚úÖ |
| –ü—Ä–æ–≥–Ω–æ–∑—ã –Ω–∞ –º–∞—Ç—á–∏ | ‚ö†Ô∏è **15 –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –≤ –Ω–µ–¥–µ–ª—é** |
| –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã | ‚úÖ **–£–ª—É—á—à–µ–Ω–Ω—ã–µ** (√ó1.5 –º–Ω–æ–∂–∏—Ç–µ–ª—å) |
| –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è | ‚úÖ **–í—Å–µ –æ–±—â–∏–µ + FAN-only** |
| –ò—Å—Ç–æ—Ä–∏—è –º–∞—Ç—á–µ–π | ‚úÖ **–ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 –º–∞—Ç—á–µ–π** |
| –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ | ‚úÖ **–ë–µ–∑–ª–∏–º–∏—Ç–Ω–æ** |
| –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≥–æ–ª–∞—Ö | ‚úÖ |
| –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–æ–≤ | ‚úÖ |
| **–ë–µ–∑ —Ä–µ–∫–ª–∞–º—ã** | ‚úÖ |

### –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø (LEGEND ‚Äî –ø—Ä–µ–º–∏—É–º)
| –§—É–Ω–∫—Ü–∏—è | –î–æ—Å—Ç—É–ø |
|---------|--------|
| –í—Å—ë –∏–∑ FAN | ‚úÖ |
| –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ **–≤—Å–µ –∫–æ–º–∞–Ω–¥—ã** | ‚úÖ –ë–µ–∑–ª–∏–º–∏—Ç–Ω–æ |
| –ü—Ä–æ–≥–Ω–æ–∑—ã | ‚úÖ **–ë–µ–∑–ª–∏–º–∏—Ç–Ω–æ** |
| –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã | ‚úÖ **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ** (√ó2 –º–Ω–æ–∂–∏—Ç–µ–ª—å) |
| –í—Å–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è | ‚úÖ –í–∫–ª—é—á–∞—è —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ |
| –ò—Å—Ç–æ—Ä–∏—è –º–∞—Ç—á–µ–π | ‚úÖ **–ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è** |
| –≠–∫—Å–ø–æ—Ä—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ | ‚úÖ CSV/PDF |
| API –¥–æ—Å—Ç—É–ø | ‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∫–ª—é—á |
| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ | ‚úÖ |
| **–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π badge** –≤ –ø—Ä–æ—Ñ–∏–ª–µ | üèÜ |
| –†–∞–Ω–Ω–∏–π –¥–æ—Å—Ç—É–ø –∫ –Ω–æ–≤—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º | ‚úÖ |

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. –ú–æ–¥–µ–ª—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```prisma
// –î–æ–±–∞–≤–∏—Ç—å –≤ schema.prisma

enum SubscriptionTier {
  ROOKIE   // –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π
  FAN      // –°—Ä–µ–¥–Ω–∏–π
  LEGEND   // –ü—Ä–µ–º–∏—É–º
}

enum SubscriptionStatus {
  ACTIVE
  EXPIRED
  CANCELLED
}

model UserSubscription {
  id              Int                @id @default(autoincrement()) @map("subscription_id")
  userId          Int                @unique @map("user_id")
  tier            SubscriptionTier   @default(ROOKIE)
  status          SubscriptionStatus @default(ACTIVE)
  starsPaid       Int?               @map("stars_paid")     // –°–∫–æ–ª—å–∫–æ Stars –∑–∞–ø–ª–∞—á–µ–Ω–æ
  expiresAt       DateTime?          @map("expires_at")     // null = –±–µ—Å—Å—Ä–æ—á–Ω—ã–π (ROOKIE)
  autoRenew       Boolean            @default(true) @map("auto_renew")
  telegramPayId   String?            @map("telegram_pay_id") // ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ Telegram
  createdAt       DateTime           @default(now()) @map("created_at")
  updatedAt       DateTime           @updatedAt @map("updated_at")
  
  user            AppUser            @relation(fields: [userId], references: [id], onDelete: Cascade)
  history         SubscriptionHistory[]

  @@index([expiresAt, status])
  @@map("user_subscription")
}

model SubscriptionHistory {
  id              Int                @id @default(autoincrement()) @map("history_id")
  subscriptionId  Int                @map("subscription_id")
  previousTier    SubscriptionTier   @map("previous_tier")
  newTier         SubscriptionTier   @map("new_tier")
  starsPaid       Int?               @map("stars_paid")
  telegramPayId   String?            @map("telegram_pay_id")
  reason          String?            // upgrade, downgrade, expired, refund
  createdAt       DateTime           @default(now()) @map("created_at")
  
  subscription    UserSubscription   @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
  
  @@index([subscriptionId, createdAt])
  @@map("subscription_history")
}

model SubscriptionPlan {
  id              Int                @id @default(autoincrement()) @map("plan_id")
  tier            SubscriptionTier   @unique
  starsPrice      Int                @map("stars_price")    // –¶–µ–Ω–∞ –≤ Stars
  durationDays    Int                @map("duration_days")  // 30 –¥–ª—è –º–µ—Å—è—á–Ω–æ–π
  name            String             // "FAN", "LEGEND"
  description     String?
  features        Json               // –°–ø–∏—Å–æ–∫ —Ñ–∏—á –≤ JSON
  isActive        Boolean            @default(true) @map("is_active")
  sortOrder       Int                @default(0) @map("sort_order")
  
  @@map("subscription_plan")
}
```

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Stars

```typescript
// backend/src/services/telegramPayments.ts

import { Bot, InlineKeyboard } from 'grammy'

const bot = new Bot(process.env.TELEGRAM_BOT_TOKEN!)

interface CreateInvoiceParams {
  userId: number
  tier: 'FAN' | 'LEGEND'
  starsAmount: number
}

export async function createStarsInvoice(params: CreateInvoiceParams): Promise<string> {
  const { userId, tier, starsAmount } = params
  
  // –°–æ–∑–¥–∞—ë–º invoice link –¥–ª—è Telegram Stars
  const invoiceLink = await bot.api.createInvoiceLink({
    title: `–ü–æ–¥–ø–∏—Å–∫–∞ ${tier}`,
    description: `–ü–æ–¥–ø–∏—Å–∫–∞ —É—Ä–æ–≤–Ω—è ${tier} –Ω–∞ 30 –¥–Ω–µ–π`,
    payload: JSON.stringify({ userId, tier, timestamp: Date.now() }),
    provider_token: '', // –ü—É—Å—Ç–æ–π –¥–ª—è Stars
    currency: 'XTR', // Telegram Stars
    prices: [{ label: `–ü–æ–¥–ø–∏—Å–∫–∞ ${tier}`, amount: starsAmount }],
  })
  
  return invoiceLink
}

// Webhook handler –¥–ª—è —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã
export async function handleSuccessfulPayment(
  telegramId: bigint,
  payload: string,
  telegramPaymentChargeId: string
): Promise<void> {
  const { userId, tier } = JSON.parse(payload)
  
  await prisma.$transaction(async (tx) => {
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥–ø–∏—Å–∫—É
    const expiresAt = new Date()
    expiresAt.setDate(expiresAt.getDate() + 30)
    
    const subscription = await tx.userSubscription.upsert({
      where: { userId },
      create: {
        userId,
        tier,
        status: 'ACTIVE',
        expiresAt,
        telegramPayId: telegramPaymentChargeId,
      },
      update: {
        tier,
        status: 'ACTIVE',
        expiresAt,
        telegramPayId: telegramPaymentChargeId,
      },
    })
    
    // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
    await tx.subscriptionHistory.create({
      data: {
        subscriptionId: subscription.id,
        previousTier: subscription.tier,
        newTier: tier,
        telegramPayId: telegramPaymentChargeId,
        reason: 'purchase',
      },
    })
  })
}
```

### 3. Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞

```typescript
// backend/src/middleware/tierGuard.ts

import { FastifyRequest, FastifyReply } from 'fastify'

type TierLevel = 'ROOKIE' | 'FAN' | 'LEGEND'

const TIER_HIERARCHY: Record<TierLevel, number> = {
  ROOKIE: 0,
  FAN: 1,
  LEGEND: 2,
}

export function requireTier(minTier: TierLevel) {
  return async (request: FastifyRequest, reply: FastifyReply) => {
    const userId = request.userId // –∏–∑ auth middleware
    
    const subscription = await prisma.userSubscription.findUnique({
      where: { userId },
      select: { tier: true, status: true, expiresAt: true },
    })
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∏ —Å—Ä–æ–∫
    const isActive = subscription?.status === 'ACTIVE' &&
      (!subscription.expiresAt || subscription.expiresAt > new Date())
    
    const currentTier: TierLevel = isActive ? subscription!.tier : 'ROOKIE'
    
    if (TIER_HIERARCHY[currentTier] < TIER_HIERARCHY[minTier]) {
      return reply.status(403).send({
        ok: false,
        error: 'subscription_required',
        requiredTier: minTier,
        currentTier,
      })
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º tier –≤ request –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ handlers
    request.userTier = currentTier
  }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
fastify.get('/api/stats/export', 
  { preHandler: requireTier('LEGEND') },
  exportStatsHandler
)
```

### 4. –õ–∏–º–∏—Ç—ã –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

```typescript
// frontend/src/utils/tierLimits.ts

export const TIER_LIMITS = {
  ROOKIE: {
    clubSubscriptions: 1,
    predictionsPerWeek: 3,
    commentsPerDay: 3,
    matchHistoryDays: 30,
    dailyRewardMultiplier: 1,
  },
  FAN: {
    clubSubscriptions: 5,
    predictionsPerWeek: 15,
    commentsPerDay: Infinity,
    matchHistoryDays: 180,
    dailyRewardMultiplier: 1.5,
  },
  LEGEND: {
    clubSubscriptions: Infinity,
    predictionsPerWeek: Infinity,
    commentsPerDay: Infinity,
    matchHistoryDays: Infinity,
    dailyRewardMultiplier: 2,
  },
} as const

export function canSubscribeToClub(
  tier: keyof typeof TIER_LIMITS,
  currentSubscriptions: number
): boolean {
  return currentSubscriptions < TIER_LIMITS[tier].clubSubscriptions
}
```

---

## –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)

| –û–ø–µ—Ä–∞—Ü–∏—è | –ß–∞—Å—Ç–æ—Ç–∞ | –ò–Ω–¥–µ–∫—Å | –ù–∞–≥—Ä—É–∑–∫–∞ |
|----------|---------|--------|----------|
| –ü—Ä–æ–≤–µ—Ä–∫–∞ tier | –ö–∞–∂–¥—ã–π API-–∑–∞–ø—Ä–æ—Å | `user_subscription.userId` | ‚ö†Ô∏è **–í—ã—Å–æ–∫–∞—è** |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ expiresAt | Cron –∫–∞–∂–¥—ã–π —á–∞—Å | `expiresAt, status` | üü¢ –ù–∏–∑–∫–∞—è |
| –ó–∞–ø–∏—Å—å –∏—Å—Ç–æ—Ä–∏–∏ | –ü—Ä–∏ –æ–ø–ª–∞—Ç–µ | `subscription_id` | üü¢ –ù–∏–∑–∫–∞—è |

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
```sql
-- –ü–æ–∫—Ä—ã–≤–∞—é—â–∏–π –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
CREATE INDEX user_sub_tier_check_idx 
ON user_subscription (user_id) 
INCLUDE (tier, status, expires_at);
```

**–û—Ü–µ–Ω–∫–∞ —Ä–æ—Å—Ç–∞:**
- +2 —Ç–∞–±–ª–∏—Ü—ã (~1-2 KB –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- +1-2 –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –∫–∞–∂–¥—ã–π API-–≤—ã–∑–æ–≤

### Redis (–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)

```typescript
// –ö—ç—à–∏—Ä—É–µ–º tier –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const TIER_CACHE_TTL = 300 // 5 –º–∏–Ω—É—Ç

async function getUserTier(userId: number): Promise<TierLevel> {
  const cacheKey = `user:${userId}:tier`
  
  const cached = await redis.get(cacheKey)
  if (cached) return cached as TierLevel
  
  const subscription = await prisma.userSubscription.findUnique({
    where: { userId },
    select: { tier: true, status: true, expiresAt: true },
  })
  
  const tier = (subscription?.status === 'ACTIVE' && 
    (!subscription.expiresAt || subscription.expiresAt > new Date()))
    ? subscription.tier
    : 'ROOKIE'
  
  await redis.setex(cacheKey, TIER_CACHE_TTL, tier)
  return tier
}
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å Redis:**
- ~50 –±–∞–π—Ç –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–∏ 10K –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ~500 KB

### –°–µ—Ä–≤–µ—Ä (CPU/Memory)

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ò–∑–º–µ–Ω–µ–Ω–∏–µ | –í–ª–∏—è–Ω–∏–µ |
|-----------|-----------|---------|
| Middleware –ø—Ä–æ–≤–µ—Ä–∫–∏ | +1 Redis GET | üü¢ –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ |
| Webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞ | ~100ms –Ω–∞ –æ–ø–ª–∞—Ç—É | üü¢ –†–µ–¥–∫–æ |
| Cron expired check | 1 —Ä–∞–∑/—á–∞—Å | üü¢ –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** –ù–∞–≥—Ä—É–∑–∫–∞ —É–≤–µ–ª–∏—á–∏—Ç—Å—è –Ω–∞ **5-10%** –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–∏.

---

## –°–ª–æ–∂–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Telegram Payments ‚ö†Ô∏è **–°—Ä–µ–¥–Ω—è—è**
- –ù—É–∂–µ–Ω `pre_checkout_query` handler
- Webhook –¥–ª—è `successful_payment`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ refunds
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ sandbox

### 2. –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π üü¢ **–ù–∏–∑–∫–∞—è**
- –í—Å–µ –ø–æ–ª—É—á–∞—é—Ç ROOKIE –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –ù–µ –ª–æ–º–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### 3. Frontend –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è ‚ö†Ô∏è **–°—Ä–µ–¥–Ω—è—è**
- –ù—É–∂–Ω—ã UX –¥–ª—è "–∞–ø–≥—Ä–µ–π–¥" –ø—Ä–æ–º–ø—Ç–æ–≤
- Graceful degradation –ø—Ä–∏ –ª–∏–º–∏—Ç–∞—Ö
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–æ–π

### 4. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è ‚ö†Ô∏è **–°—Ä–µ–¥–Ω—è—è**
- Webhook –º–æ–∂–µ—Ç –ø—Ä–∏–π—Ç–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
- –ù—É–∂–Ω–∞ polling —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫ üü¢ **–ù–∏–∑–∫–∞—è**
- Cron job —Ä–∞–∑ –≤ —á–∞—Å
- Downgrade –¥–æ ROOKIE

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–¥–µ–∏ –¥–ª—è –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏

### –†–∞–∑–æ–≤—ã–µ –ø–æ–∫—É–ø–∫–∏ (–Ω–µ –ø–æ–¥–ø–∏—Å–∫–∞)
| –¢–æ–≤–∞—Ä | –¶–µ–Ω–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| –ö–∞—Å—Ç–æ–º–Ω—ã–π badge | 50‚≠ê | –£–Ω–∏–∫–∞–ª—å–Ω–∞—è –∏–∫–æ–Ω–∫–∞ –≤ –ø—Ä–æ—Ñ–∏–ª–µ |
| –°–º–µ–Ω–∞ –Ω–∏–∫–Ω–µ–π–º–∞ | 30‚≠ê | –û–¥–∏–Ω —Ä–∞–∑ |
| Boost –ø—Ä–æ–≥–Ω–æ–∑–∞ | 10‚≠ê | √ó2 –æ—á–∫–∏ –∑–∞ –æ–¥–∏–Ω –ø—Ä–æ–≥–Ω–æ–∑ |
| –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω–∞—è —Ç–µ–º–∞ | 100‚≠ê | –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ |

### –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ LEGEND
- **Fantasy League** ‚Äî —Å–æ–±–µ—Ä–∏ —Å–≤–æ—é –∫–æ–º–∞–Ω–¥—É
- **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤** ‚Äî –≥—Ä–∞—Ñ–∏–∫–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏
- **–¢—É—Ä–Ω–∏—Ä–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–æ–≥–Ω–æ–∑–∏—Å—Ç–æ–≤** ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥
- **Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** ‚Äî –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –º–∞—Ç—á–∞—Ö
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–∞–ª–µ–Ω–¥–∞—Ä—ë–º** ‚Äî —ç–∫—Å–ø–æ—Ä—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

---

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –§–∞–∑–∞ 1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (1-2 –Ω–µ–¥–µ–ª–∏)
1. ‚úÖ –ú–æ–¥–µ–ª–∏ –ë–î + –º–∏–≥—Ä–∞—Ü–∏—è
2. ‚úÖ Telegram Payments webhook
3. ‚úÖ Middleware –ø—Ä–æ–≤–µ—Ä–∫–∏ tier
4. ‚úÖ Redis –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ tier

### –§–∞–∑–∞ 2: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (1 –Ω–µ–¥–µ–ª—è)
1. ‚¨ú –õ–∏–º–∏—Ç –ø—Ä–æ–≥–Ω–æ–∑–æ–≤
2. ‚¨ú –õ–∏–º–∏—Ç –ø–æ–¥–ø–∏—Å–æ–∫ –Ω–∞ –∫–æ–º–∞–Ω–¥—ã
3. ‚¨ú –õ–∏–º–∏—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

### –§–∞–∑–∞ 3: UI (1-2 –Ω–µ–¥–µ–ª–∏)
1. ‚¨ú –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–¥–ø–∏—Å–æ–∫
2. ‚¨ú –ö–Ω–æ–ø–∫–∏ "Upgrade" –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
3. ‚¨ú Badge –≤ –ø—Ä–æ—Ñ–∏–ª–µ
4. ‚¨ú –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–æ–π

### –§–∞–∑–∞ 4: –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ)
1. ‚¨ú –ú–µ—Ç—Ä–∏–∫–∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
2. ‚¨ú A/B —Ç–µ—Å—Ç—ã —Ü–µ–Ω
3. ‚¨ú –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ churn

---

## –¶–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è)

| –£—Ä–æ–≤–µ–Ω—å | Stars/–º–µ—Å—è—Ü | ~USD | ~RUB |
|---------|-------------|------|------|
| ROOKIE | 0 | $0 | 0‚ÇΩ |
| FAN | 75‚≠ê | ~$1.50 | ~150‚ÇΩ |
| LEGEND | 200‚≠ê | ~$4.00 | ~400‚ÇΩ |

> üí° **–°–æ–≤–µ—Ç:** –ù–∞—á–Ω–∏—Ç–µ —Å –Ω–∏–∑–∫–∏—Ö —Ü–µ–Ω –¥–ª—è –Ω–∞–±–æ—Ä–∞ –±–∞–∑—ã –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤, –∑–∞—Ç–µ–º –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø–æ–≤—ã—à–∞–π—Ç–µ.

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í–Ω–µ–¥—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥–ø–∏—Å–æ–∫ —á–µ—Ä–µ–∑ Telegram Stars ‚Äî **–≤—ã–ø–æ–ª–Ω–∏–º–∞—è –∑–∞–¥–∞—á–∞** —Å —É–º–µ—Ä–µ–Ω–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç—å—é. –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

‚úÖ –ù–∞—Ç–∏–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram  
‚úÖ –ù–∏–∑–∫–∏–π –ø–æ—Ä–æ–≥ –≤—Ö–æ–¥–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä  
‚úÖ –ü–æ–Ω—è—Ç–Ω–∞—è –º–æ–¥–µ–ª—å –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏  

–ì–ª–∞–≤–Ω—ã–µ —Ä–∏—Å–∫–∏:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —É–π—Ç–∏ –ø—Ä–∏ –∂—ë—Å—Ç–∫–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è—Ö
- –ù–µ–æ–±—Ö–æ–¥–∏–º –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É free –∏ paid —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º
- –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫
