# API —ç–Ω–¥–ø–æ–π–Ω—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–î–∞—Ç–∞:** 2025-11-05  
**–ó–∞–¥–∞—á–∞:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API —ç–Ω–¥–ø–æ–π–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∫–ª–∏–µ–Ω—Ç–æ–º  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:** GitHub Copilot

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∏–ø—ã –≤ shared/types.ts
- **–§–∞–π–ª:** `shared/types.ts`
- **–ù–æ–≤—ã–µ —Ç–∏–ø—ã:**
  ```typescript
  export interface UserAchievementLevel {
    id: number
    level: number
    threshold: number
    iconUrl: string | null
    title: string
    description: string | null
  }

  export interface UserAchievementProgress {
    achievementId: number
    achievementName: string
    achievementDescription: string | null
    currentLevel: number
    progressCount: number
    lastUnlockedAt: string | null
    levels: UserAchievementLevel[]
  }

  export interface UserAchievementsSummary {
    achievements: UserAchievementProgress[]
    totalUnlocked: number
    generatedAt: string
  }
  ```

### 2. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω API —ç–Ω–¥–ø–æ–π–Ω—Ç
- **–§–∞–π–ª:** `backend/src/routes/userRoutes.ts`
- **–≠–Ω–¥–ø–æ–π–Ω—Ç:** `GET /api/users/me/achievements`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
  - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Bearer —Ç–æ–∫–µ–Ω
  - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î
  - –í–∫–ª—é—á–∞–µ—Ç –≤—Å–µ —É—Ä–æ–≤–Ω–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π —Å –∏–∫–æ–Ω–∫–∞–º–∏, –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏, –æ–ø–∏—Å–∞–Ω–∏—è–º–∏
  - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Redis (TTL 5 –º–∏–Ω—É—Ç)
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π (`totalUnlocked`)
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞:**
  ```typescript
  {
    ok: true,
    data: {
      achievements: [...],
      totalUnlocked: 5,
      generatedAt: "2025-11-05T10:30:00.000Z"
    }
  }
  ```

### 3. –°–æ–∑–¥–∞–Ω API –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- **–§–∞–π–ª:** `frontend/src/api/achievementsApi.ts`
- **–§—É–Ω–∫—Ü–∏–∏:**
  - `fetchMyAchievements(options?: { force?: boolean })` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Å SWR –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
  - `invalidateAchievementsCache()` ‚Äî —Å–±—Ä–æ—Å–∏—Ç—å –∫—ç—à (–¥–ª—è –≤—ã–∑–æ–≤–∞ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞)
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
  - TTL: 5 –º–∏–Ω—É—Ç fresh / 15 –º–∏–Ω—É—Ç stale
  - SWR –ø–∞—Ç—Ç–µ—Ä–Ω: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫—ç—à –º–≥–Ω–æ–≤–µ–Ω–Ω–æ, –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤ —Ñ–æ–Ω–µ
  - ETag support –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ (304 Not Modified)
  - Circuit breaker: –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç stale –¥–∞–Ω–Ω—ã–µ
  - –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º (`achievements:my:v1`)

## –ö–∞–∫–∞—è –±—ã–ª–∞ –ª–æ–≥–∏–∫–∞ ‚Üí –∏ –∫–∞–∫–∞—è —Å—Ç–∞–ª–∞

**–ë—ã–ª–æ:**
- API —ç–Ω–¥–ø–æ–π–Ω—Ç –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª
- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∏–º–µ–ª–∞ CRUD –¥–ª—è —Ç–∏–ø–æ–≤ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π (`AchievementType`)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥–ª–∏ –≤–∏–¥–µ—Ç—å —Å–≤–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å

**–°—Ç–∞–ª–æ:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —Å–≤–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ `GET /api/users/me/achievements`
- API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
  - –¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫–∞–∂–¥–æ–º—É –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—é
  - –í—Å–µ —É—Ä–æ–≤–Ω–∏ —Å –ø–æ—Ä–æ–≥–∞–º–∏ –∏ –∏–∫–æ–Ω–∫–∞–º–∏
  - –î–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è
  - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π
- –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∫–ª–∏–µ–Ω—Ç —Å SWR –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
- –≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤: –∫—ç—à 5m/15m, ETag support, Redis TTL 5 –º–∏–Ω—É—Ç

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–¥–µ–ª–∏ –∏–∑ Prisma schema:
  - `UserAchievementProgress` ‚Äî –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - `AchievementType` ‚Äî —Ç–∏–ø—ã –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
  - `AchievementLevel` ‚Äî —É—Ä–æ–≤–Ω–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π —Å –∏–∫–æ–Ω–∫–∞–º–∏
- –°–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å –∞–¥–º–∏–Ω—Å–∫–æ–π –ª–æ–≥–∏–∫–æ–π (`recomputeAchievementsForType`)
- –°–ª–µ–¥—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ (SWR + ETag + localStorage)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ Bearer —Ç–æ–∫–µ–Ω

## –ü—Ä–æ–≤–µ—Ä–∫–∞

‚úÖ –ë—ç–∫–µ–Ω–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫  
‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫  
‚úÖ API —ç–Ω–¥–ø–æ–π–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é  
‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ Redis (5 –º–∏–Ω—É—Ç) –∏ localStorage (5m fresh / 15m stale)  
‚úÖ ETag support –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞  
‚úÖ Circuit breaker –¥–ª—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏  

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

‚¨ú –°–æ–∑–¥–∞—Ç—å UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –≤ Profile.tsx  
‚¨ú –î–æ–±–∞–≤–∏—Ç—å –∏–∫–æ–Ω–∫–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π  
‚¨ú –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è  
‚¨ú –ê–Ω–∏–º–∞—Ü–∏—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π  

## –ú–µ—Ç—Ä–∏—á–µ—Å–∫–æ–µ –≤–ª–∏—è–Ω–∏–µ

üîµ **–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ** ‚Äî –Ω–æ–≤—ã–π —ç–Ω–¥–ø–æ–π–Ω—Ç —Å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º (5m Redis, 5m/15m –∫–ª–∏–µ–Ω—Ç). –û–¥–∏–Ω –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ—Ñ–∏–ª—è, –∑–∞—Ç–µ–º –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è –∏–∑ –∫—ç—à–∞. ETag –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç —Ç—Ä–∞—Ñ–∏–∫ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö.
