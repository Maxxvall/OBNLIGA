# audit/code-audit-0040

**Дата:** 2025-10-15  
**Задача:** Удаление сезонов в админке и корректный вывод времени матчей  
**Исполнитель:** VSCode Agent v1.1

## 1. Поисковые запросы
- "СДЕЛАТЬ АКТИВНЫМ"
- "adminDelete("
- "toLocaleString('ru-RU'"
- "/api/admin/seasons"

## 2. Просканированные пути
- admin/src/components/tabs/MatchesTab.tsx
- admin/src/store/adminStore.ts
- admin/src/components/LineupPortalView.tsx
- backend/src/routes/adminRoutes.ts
- prisma/schema.prisma

## 3. Найденные артефакты
- `backend/src/routes/adminRoutes.ts` — реализовано удаление соревнований, но отсутствует маршрут для удаления сезона.
- `admin/src/components/tabs/MatchesTab.tsx` — блок выбора сезона без кнопки удаления.
- `admin/src/store/adminStore.ts` — отсутствие экшена для удаления сезона, только активация.
- `admin` компоненты (`MatchesTab`, `LineupPortalView`, `PlayoffBracket`, `JudgePanel`, `AssistantPanel`, `NewsTab`) используют `toLocaleString` без явного часового пояса, что приводит к смещению времени.

## 4. Решение
Адаптация существующих решений: добавить маршрут удаления сезона по аналогии с удалением соревнований, расширить стор и UI админки для вызова маршрута. Вынести форматирование дат в утилиту с явным поясом `Europe/Moscow` и применить к отображениям времени.

## 5. План реализации
- [ ] Добавить backend-эндпоинт `DELETE /api/admin/seasons/:seasonId` с очисткой зависимых данных и инвалидаторами кэша.
- [ ] Расширить `adminStore` экшеном `deleteSeason`, обновить загрузчики и обработку состояния.
- [ ] Обновить UI вкладки "Матчи" в админке: кнопка удаления сезона с подтверждением и дизейблом при загрузке.
- [ ] Создать утилиту формата даты (Europe/Moscow) и заменить прямые вызовы `toLocaleString` во всех затронутых компонентах.
- [ ] Обновить стили (кнопка удаления, выравнивание действий).
- [ ] Прогнать `npm run lint`/`npm run build` для admin и backend (при возможности локально).

## 6. Метрическое влияние
⚪ — Улучшение точности данных и UX админки, влияние на производительность нейтральное.
