generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AchievementJobs {
  id        BigInt               @id @default(autoincrement()) @map("achievement_job_id")
  status    AchievementJobStatus @default(PENDING)
  payload   Json
  attempts  Int                  @default(0)
  error     String?
  createdAt DateTime             @default(now()) @map("created_at")
  updatedAt DateTime             @updatedAt @map("updated_at")

  @@index([status, createdAt], map: "achievement_job_status_created_idx")
  @@map("achievement_jobs")
}

model AchievementLevel {
  id              Int             @id @default(autoincrement()) @map("achievement_level_id")
  achievementId   Int             @map("achievement_id")
  level           Int
  threshold       Int
  iconUrl         String?         @map("icon_url")
  title           String
  description     String?
  createdAt       DateTime        @default(now()) @map("created_at")
  updatedAt       DateTime        @updatedAt @map("updated_at")
  achievementType AchievementType @relation(fields: [achievementId], references: [id], onDelete: Cascade)

  @@unique([achievementId, level])
  @@map("achievement_level")
}

model AchievementProgress {
  id              BigInt          @id @default(autoincrement()) @map("achievement_progress_id")
  userId          Int             @map("user_id")
  achievementId   Int             @map("achievement_id")
  currentLevel    Int             @default(0) @map("current_level")
  progressCount   Int             @default(0) @map("progress_count")
  lastUnlockedAt  DateTime?       @map("last_unlocked_at")
  createdAt       DateTime        @default(now()) @map("created_at")
  updatedAt       DateTime        @updatedAt @map("updated_at")
  achievementType AchievementType @relation(fields: [achievementId], references: [id], onDelete: Cascade)
  appUser         AppUser         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, achievementId], name: "achievement_progress_unique")
  @@map("achievement_progress")
}

model AchievementType {
  id                  Int                   @id @default(autoincrement()) @map("achievement_type_id")
  name                String
  description         String?
  requiredValue       Int                   @map("required_value")
  metric              AchievementMetric
  createdAt           DateTime              @default(now()) @map("created_at")
  updatedAt           DateTime              @updatedAt @map("updated_at")
  levels              AchievementLevel[]
  achievementProgress AchievementProgress[]
  userAchievement     UserAchievement[]

  @@map("achievement_type")
}

model AdBanner {
  id           BigInt    @id @default(autoincrement()) @map("ad_banner_id")
  title        String    @db.VarChar(80)
  subtitle     String?   @db.VarChar(160)
  targetUrl    String?   @map("target_url")
  imageData    Bytes     @map("image_data")
  imageMime    String    @map("image_mime")
  imageWidth   Int       @map("image_width")
  imageHeight  Int       @map("image_height")
  imageSize    Int       @map("image_size")
  displayOrder Int       @default(0) @map("display_order")
  isActive     Boolean   @default(true) @map("is_active")
  startsAt     DateTime? @map("starts_at")
  endsAt       DateTime? @map("ends_at")
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @default(now()) @map("updated_at")

  @@index([isActive, displayOrder, updatedAt], map: "ad_banner_active_order")
  @@map("ad_banner")
}

model AdminActionLog {
  id              BigInt    @id @default(autoincrement()) @map("admin_action_log_id")
  userId          Int?      @map("user_id")
  adminIdentifier String    @map("admin_identifier")
  actionType      String    @map("action_type")
  targetType      String?   @map("target_type")
  targetId        String?   @map("target_id")
  metadata        Json?
  createdAt       DateTime  @default(now()) @map("created_at")
  expiresAt       DateTime? @map("expires_at")
  appUser         AppUser?  @relation(fields: [userId], references: [id])

  @@index([createdAt], map: "admin_action_log_created_idx")
  @@map("admin_action_log")
}

model AdminPointAdjustment {
  id              BigInt       @id @default(autoincrement()) @map("point_adjustment_id")
  userId          Int          @map("user_id")
  adminIdentifier String       @map("admin_identifier")
  delta           Int
  scope           RatingScope?
  reason          String?
  matchId         BigInt?      @map("match_id")
  createdAt       DateTime     @default(now()) @map("created_at")
  updatedAt       DateTime     @updatedAt @map("updated_at")
  appUser         AppUser      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt], map: "point_adjustment_user_created_idx")
  @@map("admin_point_adjustment")
}

model AppUser {
  id                      Int                       @id @default(autoincrement()) @map("user_id")
  telegramId              BigInt                    @unique @map("telegram_id")
  username                String?
  firstName               String?                   @map("first_name")
  photoUrl                String?                   @map("photo_url")
  registrationDate        DateTime                  @default(now()) @map("registration_date")
  lastLoginDate           DateTime?                 @map("last_login_date")
  currentStreak           Int                       @default(0) @map("current_streak")
  totalPredictions        Int                       @default(0) @map("total_predictions")
  leaguePlayerStatus      LeaguePlayerStatus        @default(NONE) @map("league_player_status")
  leaguePlayerRequestedAt DateTime?                 @map("league_player_requested_at")
  leaguePlayerVerifiedAt  DateTime?                 @map("league_player_verified_at")
  leaguePlayerId          Int?                      @map("league_player_id")
  createdAt               DateTime                  @default(now()) @map("created_at")
  updatedAt               DateTime                  @updatedAt @map("updated_at")
  achievementProgress     AchievementProgress[]
  adminActionLog          AdminActionLog[]
  adminPointAdjustment    AdminPointAdjustment[]
  leaguePlayer            Person?                   @relation(fields: [leaguePlayerId], references: [id])
  dailyRewardClaim        DailyRewardClaim[]
  predictions             Prediction[]
  predictionEntry         PredictionEntry[]
  predictionStreak        PredictionStreak?
  ratingSnapshot          RatingSnapshot[]
  shopOrder               ShopOrder[]
  achievements            UserAchievement[]
  userAchievementRewards  UserAchievementRewards[]
  userRating              UserRating?
  clubSubscriptions       ClubSubscription[]
  matchSubscriptions      MatchSubscription[]
  notificationSettings    NotificationSettings?
  notificationQueue       NotificationQueue[]
  expressBets             ExpressBet[]
  broadcastWatchTime      UserBroadcastWatchTime?

  @@map("app_user")
}

model Club {
  id                    Int                     @id @default(autoincrement()) @map("club_id")
  name                  String
  shortName             String                  @map("short_name")
  logoUrl               String?                 @map("logo_url")
  createdAt             DateTime                @default(now()) @map("created_at")
  updatedAt             DateTime                @updatedAt @map("updated_at")
  players               ClubPlayer[]
  clubSeasonStats       ClubSeasonStats[]
  disqualification      Disqualification[]
  matchAwayTeam         Match[]                 @relation("match_away_team_idToclub")
  matchHomeTeam         Match[]                 @relation("match_home_team_idToclub")
  matchEvent            MatchEvent[]
  matchLineup           MatchLineup[]
  matchSeriesAwayClub   MatchSeries[]           @relation("match_series_away_club_idToclub")
  matchSeriesHomeClub   MatchSeries[]           @relation("match_series_home_club_idToclub")
  matchSeriesWinnerClub MatchSeries[]           @relation("match_series_winner_club_idToclub")
  matchStatistic        MatchStatistic[]
  playerClubCareerStats PlayerClubCareerStats[]
  playerSeasonStats     PlayerSeasonStats[]
  seasonGroupSlot       SeasonGroupSlot[]
  seasonParticipant     SeasonParticipant[]
  seasonRoster          SeasonRoster[]
  clubSubscriptions     ClubSubscription[]

  @@map("club")
}

model ClubPlayer {
  clubId             Int      @map("club_id")
  personId           Int      @map("person_id")
  defaultShirtNumber Int?     @map("default_shirt_number")
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")
  club               Club     @relation(fields: [clubId], references: [id], onDelete: Cascade)
  person             Person   @relation(fields: [personId], references: [id], onDelete: Cascade)

  @@id([clubId, personId])
  @@map("club_player")
}

model ClubSeasonStats {
  seasonId     Int      @map("season_id")
  clubId       Int      @map("club_id")
  points       Int      @default(0)
  wins         Int      @default(0)
  losses       Int      @default(0)
  goalsFor     Int      @default(0) @map("goals_for")
  goalsAgainst Int      @default(0) @map("goals_against")
  updatedAt    DateTime @default(now()) @updatedAt @map("updated_at")
  club         Club     @relation(fields: [clubId], references: [id], onDelete: Cascade)
  season       Season   @relation(fields: [seasonId], references: [id], onDelete: Cascade)

  @@id([seasonId, clubId])
  @@map("club_season_stats")
}

model Competition {
  id           Int             @id @default(autoincrement()) @map("competition_id")
  name         String
  type         CompetitionType
  seriesFormat SeriesFormat    @map("series_format")
  createdAt    DateTime        @default(now()) @map("created_at")
  updatedAt    DateTime        @updatedAt @map("updated_at")
  season       Season[]

  @@map("competition")
}

model DailyRewardClaim {
  id            BigInt   @id @default(autoincrement()) @map("daily_reward_claim_id")
  userId        Int      @map("user_id")
  dayNumber     Int      @map("day_number")
  streakAfter   Int      @map("streak_after")
  pointsAwarded Int      @map("points_awarded")
  claimDateKey  String   @map("claim_date_key") @db.VarChar(16)
  animationKey  String   @map("animation_key") @db.VarChar(32)
  claimedAt     DateTime @default(now()) @map("claimed_at")
  metadata      Json?
  appUser       AppUser  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, claimDateKey], map: "daily_reward_unique_day")
  @@index([claimDateKey], map: "daily_reward_date_idx")
  @@map("daily_reward_claim")
}

model Disqualification {
  id                 BigInt                 @id @default(autoincrement()) @map("disqualification_id")
  personId           Int                    @map("person_id")
  clubId             Int?                   @map("club_id")
  reason             DisqualificationReason
  sanctionDate       DateTime               @map("sanction_date")
  banDurationMatches Int                    @map("ban_duration_matches")
  matchesMissed      Int                    @default(0) @map("matches_missed")
  isActive           Boolean                @default(true) @map("is_active")
  createdAt          DateTime               @default(now()) @map("created_at")
  updatedAt          DateTime               @updatedAt @map("updated_at")
  club               Club?                  @relation(fields: [clubId], references: [id])
  person             Person                 @relation(fields: [personId], references: [id], onDelete: Cascade)

  @@map("disqualification")
}

model Match {
  id                 BigInt               @id @default(autoincrement()) @map("match_id")
  seasonId           Int?                 @map("season_id")
  seriesId           BigInt?              @map("series_id")
  seriesMatchNumber  Int?                 @map("series_match_number")
  matchDateTime      DateTime             @map("match_date_time")
  homeTeamId         Int                  @map("home_team_id")
  awayTeamId         Int                  @map("away_team_id")
  homeScore          Int                  @default(0) @map("home_score")
  awayScore          Int                  @default(0) @map("away_score")
  status             MatchStatus
  stadiumId          Int?                 @map("stadium_id")
  refereeId          Int?                 @map("referee_id")
  roundId            Int?                 @map("round_id")
  groupId            Int?                 @map("group_id")
  isArchived         Boolean              @default(false) @map("is_archived")
  hasPenaltyShootout Boolean              @default(false) @map("has_penalty_shootout")
  penaltyHomeScore   Int                  @default(0) @map("penalty_home_score")
  penaltyAwayScore   Int                  @default(0) @map("penalty_away_score")
  broadcastUrl       String?              @map("broadcast_url")
  eventName          String?              @map("event_name")
  isFriendly         Boolean              @default(false) @map("is_friendly")
  createdAt          DateTime             @default(now()) @map("created_at")
  updatedAt          DateTime             @updatedAt @map("updated_at")
  awayClub           Club                 @relation("match_away_team_idToclub", fields: [awayTeamId], references: [id])
  seasonGroup        SeasonGroup?         @relation(fields: [groupId], references: [id])
  homeClub           Club                 @relation("match_home_team_idToclub", fields: [homeTeamId], references: [id])
  referee            Person?              @relation(fields: [refereeId], references: [id])
  round              SeasonRound?         @relation(fields: [roundId], references: [id])
  season             Season?              @relation(fields: [seasonId], references: [id], onDelete: Cascade)
  series             MatchSeries?         @relation(fields: [seriesId], references: [id])
  stadium            Stadium?             @relation(fields: [stadiumId], references: [id])
  events              MatchEvent[]
  lineups             MatchLineup[]
  statistics          MatchStatistic[]
  predictions         Prediction[]
  predictionTemplates PredictionTemplate[]
  matchSubscriptions  MatchSubscription[]
  notificationQueue   NotificationQueue[]

  @@unique([seriesId, seriesMatchNumber], map: "unique_series_match_number")
  @@map("match")
}

model MatchEvent {
  id              BigInt         @id @default(autoincrement()) @map("event_id")
  matchId         BigInt         @map("match_id")
  teamId          Int            @map("team_id")
  minute          Int
  eventType       MatchEventType @map("event_type")
  playerId        Int            @map("player_id")
  relatedPlayerId Int?           @map("related_player_id")
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")
  match           Match          @relation(fields: [matchId], references: [id], onDelete: Cascade)
  player          Person         @relation("match_event_player_idToperson", fields: [playerId], references: [id])
  relatedPerson   Person?        @relation("match_event_related_player_idToperson", fields: [relatedPlayerId], references: [id])
  team            Club           @relation(fields: [teamId], references: [id])

  @@map("match_event")
}

model MatchLineup {
  matchId  BigInt     @map("match_id")
  personId Int        @map("person_id")
  clubId   Int        @map("club_id")
  role     LineupRole
  position String?
  club     Club       @relation(fields: [clubId], references: [id])
  match    Match      @relation(fields: [matchId], references: [id], onDelete: Cascade)
  person   Person     @relation(fields: [personId], references: [id])

  @@id([matchId, personId])
  @@map("match_lineup")
}

model MatchSeries {
  id           BigInt        @id @default(autoincrement()) @map("series_id")
  seasonId     Int           @map("season_id")
  stageName    String        @map("stage_name")
  homeClubId   Int           @map("home_club_id")
  awayClubId   Int           @map("away_club_id")
  seriesStatus SeriesStatus  @map("series_status")
  winnerClubId Int?          @map("winner_club_id")
  homeSeed     Int?          @map("home_seed")
  awaySeed     Int?          @map("away_seed")
  bracketSlot  Int?          @map("bracket_slot")
  bracketType  BracketType?  @map("bracket_type")
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  matches      Match[]
  awayClub     Club          @relation("match_series_away_club_idToclub", fields: [awayClubId], references: [id])
  homeClub     Club          @relation("match_series_home_club_idToclub", fields: [homeClubId], references: [id])
  season       Season        @relation(fields: [seasonId], references: [id], onDelete: Cascade)
  winnerClub   Club?         @relation("match_series_winner_club_idToclub", fields: [winnerClubId], references: [id])

  @@map("match_series")
}

model MatchStatistic {
  matchId       BigInt   @map("match_id")
  clubId        Int      @map("club_id")
  totalShots    Int      @default(0) @map("total_shots")
  shotsOnTarget Int      @default(0) @map("shots_on_target")
  corners       Int      @default(0)
  yellowCards   Int      @default(0) @map("yellow_cards")
  redCards      Int      @default(0) @map("red_cards")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  club          Club     @relation(fields: [clubId], references: [id], onDelete: Cascade)
  match         Match    @relation(fields: [matchId], references: [id], onDelete: Cascade)

  @@id([matchId, clubId])
  @@map("match_statistic")
}

model News {
  id             BigInt   @id @default(autoincrement()) @map("news_id")
  title          String   @db.VarChar(100)
  content        String
  coverUrl       String?  @map("cover_url")
  sendToTelegram Boolean  @default(false) @map("send_to_telegram")
  createdAt      DateTime @default(now()) @map("created_at")

  @@index([createdAt(sort: Desc)], map: "news_created_at_desc")
  @@map("news")
}

model Person {
  id                    Int                     @id @default(autoincrement()) @map("person_id")
  firstName             String                  @map("first_name")
  lastName              String                  @map("last_name")
  isPlayer              Boolean                 @default(true) @map("is_player")
  createdAt             DateTime                @default(now()) @map("created_at")
  updatedAt             DateTime                @updatedAt @map("updated_at")
  appUser               AppUser[]
  clubAffiliations      ClubPlayer[]
  disqualification      Disqualification[]
  match                 Match[]
  matchEventPlayer      MatchEvent[]            @relation("match_event_player_idToperson")
  matchEventRelated     MatchEvent[]            @relation("match_event_related_player_idToperson")
  matchLineup           MatchLineup[]
  playerClubCareerStats PlayerClubCareerStats[]
  playerSeasonStats     PlayerSeasonStats[]
  seasonRoster          SeasonRoster[]

  @@map("person")
}

model PlayerClubCareerStats {
  personId     Int    @map("person_id")
  clubId       Int    @map("club_id")
  totalGoals   Int    @default(0) @map("total_goals")
  penaltyGoals Int    @default(0) @map("penalty_goals")
  totalMatches Int    @default(0) @map("total_matches")
  totalAssists Int    @default(0) @map("total_assists")
  yellowCards  Int    @default(0) @map("yellow_cards")
  redCards     Int    @default(0) @map("red_cards")
  club         Club   @relation(fields: [clubId], references: [id], onDelete: Cascade)
  person       Person @relation(fields: [personId], references: [id], onDelete: Cascade)

  @@id([personId, clubId])
  @@map("player_club_career_stats")
}

model PlayerSeasonStats {
  seasonId      Int      @map("season_id")
  personId      Int      @map("person_id")
  clubId        Int      @map("club_id")
  goals         Int      @default(0)
  penaltyGoals  Int      @default(0) @map("penalty_goals")
  assists       Int      @default(0)
  yellowCards   Int      @default(0) @map("yellow_cards")
  redCards      Int      @default(0) @map("red_cards")
  matchesPlayed Int      @default(0) @map("matches_played")
  updatedAt     DateTime @default(now()) @updatedAt @map("updated_at")
  club          Club     @relation(fields: [clubId], references: [id], onDelete: Cascade)
  person        Person   @relation(fields: [personId], references: [id], onDelete: Cascade)
  season        Season   @relation(fields: [seasonId], references: [id], onDelete: Cascade)

  @@id([seasonId, personId])
  @@map("player_season_stats")
}

model Prediction {
  id             BigInt            @id @default(autoincrement()) @map("prediction_id")
  userId         Int               @map("user_id")
  matchId        BigInt            @map("match_id")
  predictionDate DateTime          @map("prediction_date")
  result1x2      PredictionResult? @map("result_1x2")
  totalGoalsOver Float?            @map("total_goals_over")
  penaltyYes     Boolean?          @map("penalty_yes")
  redCardYes     Boolean?          @map("red_card_yes")
  isCorrect      Boolean?          @map("is_correct")
  pointsAwarded  Int               @default(0) @map("points_awarded")
  createdAt      DateTime          @default(now()) @map("created_at")
  updatedAt      DateTime          @updatedAt @map("updated_at")
  match          Match             @relation(fields: [matchId], references: [id], onDelete: Cascade)
  user           AppUser           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, matchId])
  @@map("prediction")
}

model PredictionEntry {
  id                 BigInt                @id @default(autoincrement()) @map("prediction_entry_id")
  templateId         BigInt                @map("template_id")
  userId             Int                   @map("user_id")
  selection          String
  submittedAt        DateTime              @default(now()) @map("submitted_at")
  scoreAwarded       Int?                  @map("score_awarded")
  status             PredictionEntryStatus @default(PENDING)
  resolutionMeta     Json?                 @map("resolution_meta")
  resolvedAt         DateTime?             @map("resolved_at")
  createdAt          DateTime              @default(now()) @map("created_at")
  template PredictionTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)
  appUser  AppUser            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, templateId], map: "prediction_entry_user_template_unique")
  @@index([templateId, status], map: "prediction_entry_template_status_idx")
  @@map("prediction_entry")
}

model PredictionStreak {
  userId           Int       @id @map("user_id")
  currentStreak    Int       @default(0) @map("current_streak")
  maxStreak        Int       @default(0) @map("max_streak")
  lastPredictionAt DateTime? @map("last_prediction_at")
  lastResolvedAt   DateTime? @map("last_resolved_at")
  updatedAt        DateTime  @updatedAt @map("updated_at")
  createdAt        DateTime  @default(now()) @map("created_at")
  appUser          AppUser   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("prediction_streak")
}

model PredictionTemplate {
  id                   BigInt               @id @default(autoincrement()) @map("prediction_template_id")
  matchId              BigInt               @map("match_id")
  marketType           PredictionMarketType @map("market_type")
  options              Json
  basePoints           Int                  @default(0) @map("base_points")
  difficultyMultiplier Decimal              @default(1.0) @map("difficulty_multiplier")
  isManual             Boolean              @default(false) @map("is_manual")
  createdBy            String?              @map("created_by")
  createdAt            DateTime             @default(now()) @map("created_at")
  updatedAt            DateTime             @updatedAt @map("updated_at")
  entries              PredictionEntry[]
  match                Match                @relation(fields: [matchId], references: [id], onDelete: Cascade)
  expressItems         ExpressBetItem[]

  @@index([matchId, marketType], map: "prediction_template_match_market_idx")
  @@map("prediction_template")
}

model RatingSeason {
  id                 BigInt               @id @default(autoincrement()) @map("rating_season_id")
  scope              RatingScope
  startsAt           DateTime             @map("starts_at")
  endsAt             DateTime             @map("ends_at")
  closedAt           DateTime?            @map("closed_at")
  durationDays       Int                  @map("duration_days")
  createdAt    DateTime             @default(now()) @map("created_at")
  updatedAt    DateTime             @updatedAt @map("updated_at")
  winners      RatingSeasonWinner[]

  @@index([scope, closedAt], map: "rating_season_scope_closed_idx")
  @@index([scope, startsAt], map: "rating_season_scope_start_idx")
  @@map("rating_season")
}

model RatingSeasonWinner {
  id              BigInt       @id @default(autoincrement()) @map("rating_season_winner_id")
  seasonId        BigInt       @map("season_id")
  userId          Int          @map("user_id")
  rank            Int
  scopePoints     Int          @map("scope_points")
  totalPoints     Int          @map("total_points")
  predictionCount Int          @default(0) @map("prediction_count")
  predictionWins  Int          @default(0) @map("prediction_wins")
  displayName     String       @map("display_name")
  username        String?
  photoUrl        String?      @map("photo_url")
  createdAt       DateTime     @default(now()) @map("created_at")
  ratingSeason    RatingSeason @relation(fields: [seasonId], references: [id], onDelete: Cascade)

  @@unique([seasonId, rank], map: "rating_season_winner_season_rank_unique")
  @@index([userId, seasonId], map: "rating_season_winner_user_idx")
  @@map("rating_season_winner")
}

model RatingSettings {
  id               Int      @id @default(autoincrement()) @map("rating_settings_id")
  currentScopeDays Int      @map("current_scope_days")
  yearlyScopeDays  Int      @map("yearly_scope_days")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  @@map("rating_settings")
}

model RatingSnapshot {
  id         BigInt      @id @default(autoincrement()) @map("rating_snapshot_id")
  userId     Int         @map("user_id")
  scope      RatingScope
  rank       Int
  points     Int
  capturedAt DateTime    @map("captured_at")
  payload    Json?
  appUser    AppUser     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([scope, capturedAt], map: "rating_snapshot_scope_captured_idx")
  @@map("rating_snapshot")
}

model Season {
  id                Int                 @id @default(autoincrement()) @map("season_id")
  competitionId     Int                 @map("competition_id")
  name              String
  startDate         DateTime            @map("start_date")
  endDate           DateTime            @map("end_date")
  city              String?
  seriesFormat      SeriesFormat?       @map("series_format")
  groupRounds       Int                 @default(1) @map("group_rounds")
  playoffBestOf     Int                 @default(1) @map("playoff_best_of")
  isActive          Boolean             @default(false) @map("is_active")
  isArchived        Boolean             @default(false) @map("is_archived")
  archivedAt        DateTime?           @map("archived_at")
  archivedBy        String?             @map("archived_by")
  createdAt         DateTime            @default(now()) @map("created_at")
  updatedAt         DateTime            @updatedAt @map("updated_at")
  clubSeasonStats   ClubSeasonStats[]
  matches           Match[]
  series            MatchSeries[]
  playerSeasonStats PlayerSeasonStats[]
  competition       Competition         @relation(fields: [competitionId], references: [id])
  groups            SeasonGroup[]
  participants      SeasonParticipant[]
  rosters           SeasonRoster[]
  rounds            SeasonRound[]
  archive           SeasonArchive?

  @@index([isArchived, startDate], map: "season_archived_start_idx")
  @@index([isArchived, competitionId], map: "season_archived_competition_idx")
  @@map("season")
}

model SeasonArchive {
  id                BigInt   @id @default(autoincrement()) @map("season_archive_id")
  seasonId          Int      @unique @map("season_id")
  archivedAt        DateTime @default(now()) @map("archived_at")
  archivedBy        String?  @map("archived_by")
  schemaVersion     Int      @default(1) @map("schema_version")
  summary           Json
  standings         Json
  topScorers        Json     @map("top_scorers")
  topAssists        Json     @map("top_assists")
  playoffBracket    Json     @map("playoff_bracket")
  groups            Json
  matchSummaries    Json     @map("match_summaries")
  achievements      Json
  totalMatches      Int      @map("total_matches")
  totalGoals        Int      @map("total_goals")
  totalCards        Int      @map("total_cards")
  participantsCount Int      @map("participants_count")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  season            Season   @relation(fields: [seasonId], references: [id], onDelete: Cascade)

  @@index([archivedAt], map: "season_archive_archived_idx")
  @@map("season_archive")
}

model SeasonGroup {
  id              Int               @id @default(autoincrement()) @map("season_group_id")
  seasonId        Int               @map("season_id")
  groupIndex      Int               @map("group_index")
  label           String
  qualifyCount    Int               @map("qualify_count")
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @updatedAt @map("updated_at")
  match           Match[]
  season          Season            @relation(fields: [seasonId], references: [id], onDelete: Cascade)
  slots           SeasonGroupSlot[]
  seasonRound     SeasonRound[]

  @@unique([seasonId, groupIndex])
  @@map("season_group")
}

model SeasonGroupSlot {
  id          Int         @id @default(autoincrement()) @map("season_group_slot_id")
  groupId     Int         @map("group_id")
  position    Int
  clubId      Int?        @map("club_id")
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")
  club        Club?       @relation(fields: [clubId], references: [id])
  seasonGroup SeasonGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@unique([groupId, position])
  @@map("season_group_slot")
}

model SeasonParticipant {
  seasonId Int    @map("season_id")
  clubId   Int    @map("club_id")
  club     Club   @relation(fields: [clubId], references: [id])
  season   Season @relation(fields: [seasonId], references: [id], onDelete: Cascade)

  @@id([seasonId, clubId])
  @@map("season_participant")
}

model SeasonRoster {
  seasonId         Int      @map("season_id")
  clubId           Int      @map("club_id")
  personId         Int      @map("person_id")
  shirtNumber      Int      @map("shirt_number")
  registrationDate DateTime @map("registration_date")
  club             Club     @relation(fields: [clubId], references: [id], onDelete: Cascade)
  person           Person   @relation(fields: [personId], references: [id])
  season           Season   @relation(fields: [seasonId], references: [id], onDelete: Cascade)

  @@id([seasonId, clubId, personId])
  @@unique([seasonId, clubId, shirtNumber])
  @@map("season_roster")
}

model SeasonRound {
  id          Int          @id @default(autoincrement()) @map("round_id")
  seasonId    Int          @map("season_id")
  roundType   RoundType    @map("round_type")
  roundNumber Int?         @map("round_number")
  label       String
  groupId     Int?         @map("group_id")
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")
  match       Match[]
  seasonGroup SeasonGroup? @relation(fields: [groupId], references: [id])
  season      Season       @relation(fields: [seasonId], references: [id], onDelete: Cascade)

  @@unique([seasonId, label])
  @@map("season_round")
}

model ShopItem {
  id            Int             @id @default(autoincrement()) @map("shop_item_id")
  slug          String?         @unique(map: "shop_item_slug_unique")
  title         String          @db.VarChar(80)
  subtitle      String?         @db.VarChar(160)
  description   String?
  priceCents    Int             @map("price_cents")
  currencyCode  String          @default("RUB") @map("currency_code")
  stockQuantity Int?            @map("stock_quantity")
  maxPerOrder   Int             @default(3) @map("max_per_order")
  sortOrder     Int             @default(100) @map("sort_order")
  isActive      Boolean         @default(true) @map("is_active")
  imageUrl      String?         @map("image_url")
  imageData     Bytes?          @map("image_data")
  imageMime     String?         @map("image_mime")
  imageWidth    Int?            @map("image_width")
  imageHeight   Int?            @map("image_height")
  imageSize     Int?            @map("image_size")
  createdAt     DateTime        @default(now()) @map("created_at")
  updatedAt     DateTime        @updatedAt @map("updated_at")
  shopOrderItem ShopOrderItem[]

  @@index([isActive, sortOrder], map: "shop_item_active_order_idx")
  @@map("shop_item")
}

model ShopOrder {
  id           BigInt          @id @default(autoincrement()) @map("shop_order_id")
  orderNumber  String          @unique @map("order_number")
  userId       Int?            @map("user_id")
  telegramId   BigInt?         @map("telegram_id")
  username     String?
  firstName    String?         @map("first_name")
  status       ShopOrderStatus @default(PENDING)
  totalCents   Int             @map("total_cents")
  currencyCode String          @default("RUB") @map("currency_code")
  customerNote String?         @map("customer_note")
  confirmedAt  DateTime?       @map("confirmed_at")
  confirmedBy  String?         @map("confirmed_by")
  createdAt    DateTime        @default(now()) @map("created_at")
  updatedAt    DateTime        @updatedAt @map("updated_at")
  user         AppUser?        @relation(fields: [userId], references: [id])
  items        ShopOrderItem[]

  @@index([status, createdAt], map: "shop_order_status_created_idx")
  @@map("shop_order")
}

model ShopOrderItem {
  id         BigInt    @id @default(autoincrement()) @map("shop_order_item_id")
  orderId    BigInt    @map("order_id")
  itemId     Int       @map("item_id")
  title      String    @db.VarChar(80)
  subtitle   String?   @db.VarChar(160)
  priceCents Int       @map("price_cents")
  quantity   Int
  imageUrl   String?   @map("image_url")
  item      ShopItem  @relation(fields: [itemId], references: [id])
  shopOrder ShopOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([itemId], map: "shop_order_item_item_idx")
  @@index([orderId], map: "shop_order_item_order_idx")
  @@map("shop_order_item")
}

model Stadium {
  id        Int      @id @default(autoincrement()) @map("stadium_id")
  name      String
  city      String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  match     Match[]

  @@map("stadium")
}

model UserAchievement {
  userId            Int             @map("user_id")
  achievementTypeId Int             @map("achievement_type_id")
  achievedDate      DateTime        @map("achieved_date")
  achievementType   AchievementType @relation(fields: [achievementTypeId], references: [id], onDelete: Cascade)
  user              AppUser         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, achievementTypeId])
  @@map("user_achievement")
}

model UserAchievementRewards {
  id        BigInt   @id @default(autoincrement()) @map("user_achievement_reward_id")
  userId    Int      @map("user_id")
  group     String
  tier      Int
  seasonId  Int?     @map("season_id")
  points    Int
  notified  Boolean  @default(false)
  createdAt DateTime @default(now()) @map("created_at")
  appUser   AppUser  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, group, tier, seasonId])
  @@index([userId, notified], map: "user_achievement_reward_user_notified_idx")
  @@map("user_achievement_rewards")
}

model UserRating {
  userId             Int         @id @map("user_id")
  totalPoints        Int         @default(0) @map("total_points")
  seasonalPoints     Int         @default(0) @map("seasonal_points")
  yearlyPoints       Int         @default(0) @map("yearly_points")
  mythicRank         Int?        @map("mythic_rank")
  currentLevel       RatingLevel @default(BRONZE) @map("current_level")
  predictionCount    Int         @default(0) @map("prediction_count")
  predictionWins     Int         @default(0) @map("prediction_wins")
  lastRecalculatedAt DateTime?   @map("last_recalculated_at")
  createdAt          DateTime    @default(now()) @map("created_at")
  updatedAt          DateTime    @updatedAt @map("updated_at")
  user               AppUser     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_rating")
}

enum AchievementJobStatus {
  PENDING
  PROCESSING
  DONE
  FAILED
}

enum AchievementMetric {
  DAILY_LOGIN
  TOTAL_PREDICTIONS
  CORRECT_PREDICTIONS
  SEASON_POINTS
  PREDICTION_STREAK
  EXPRESS_WINS
  BROADCAST_WATCH_TIME
}

enum CompetitionType {
  LEAGUE
  CUP
}

enum DisqualificationReason {
  RED_CARD
  SECOND_YELLOW
  ACCUMULATED_CARDS
  OTHER
}

enum LeaguePlayerStatus {
  NONE
  PENDING
  VERIFIED
}

enum LineupRole {
  STARTER
  SUBSTITUTE
}

enum MatchEventType {
  GOAL
  PENALTY_GOAL
  OWN_GOAL
  PENALTY_MISSED
  YELLOW_CARD
  SECOND_YELLOW_CARD
  RED_CARD
  SUB_IN
  SUB_OUT
}

enum MatchStatus {
  SCHEDULED
  LIVE
  FINISHED
  POSTPONED
}

enum PredictionEntryStatus {
  PENDING
  WON
  LOST
  VOID
  CANCELLED
  EXPIRED
}

enum PredictionMarketType {
  MATCH_OUTCOME
  TOTAL_GOALS
  CUSTOM_BOOLEAN
}

enum PredictionResult {
  ONE
  DRAW
  TWO
}

enum RatingLevel {
  BRONZE
  SILVER
  GOLD
  PLATINUM
  DIAMOND
  MYTHIC
}

enum RatingScope {
  CURRENT
  YEARLY
}

enum RoundType {
  REGULAR
  PLAYOFF
}

enum SeriesFormat {
  SINGLE_MATCH
  TWO_LEGGED
  BEST_OF_N
  DOUBLE_ROUND_PLAYOFF
  PLAYOFF_BRACKET
  GROUP_SINGLE_ROUND_PLAYOFF
}

enum SeriesStatus {
  IN_PROGRESS
  FINISHED
}

enum BracketType {
  QUALIFICATION
  GOLD
  SILVER
}

enum ShopOrderStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

// =================== ПОДПИСКИ И УВЕДОМЛЕНИЯ ===================

// Подписки на команды
model ClubSubscription {
  id        Int      @id @default(autoincrement()) @map("subscription_id")
  userId    Int      @map("user_id")
  clubId    Int      @map("club_id")
  createdAt DateTime @default(now()) @map("created_at")

  user AppUser @relation(fields: [userId], references: [id], onDelete: Cascade)
  club Club    @relation(fields: [clubId], references: [id], onDelete: Cascade)

  @@unique([userId, clubId], map: "club_subscription_user_club_unique")
  @@index([clubId], map: "club_subscription_club_idx")
  @@map("club_subscription")
}

// Подписки на конкретные матчи
model MatchSubscription {
  id        Int      @id @default(autoincrement()) @map("subscription_id")
  userId    Int      @map("user_id")
  matchId   BigInt   @map("match_id")
  createdAt DateTime @default(now()) @map("created_at")

  user  AppUser @relation(fields: [userId], references: [id], onDelete: Cascade)
  match Match   @relation(fields: [matchId], references: [id], onDelete: Cascade)

  @@unique([userId, matchId], map: "match_subscription_user_match_unique")
  @@index([matchId], map: "match_subscription_match_idx")
  @@map("match_subscription")
}

// Настройки уведомлений пользователя
model NotificationSettings {
  id                Int      @id @default(autoincrement()) @map("settings_id")
  userId            Int      @unique @map("user_id")
  enabled           Boolean  @default(true)
  remindBefore      Int      @default(30) @map("remind_before") // минуты до матча
  matchStartEnabled Boolean  @default(true) @map("match_start_enabled")
  matchEndEnabled   Boolean  @default(false) @map("match_end_enabled")
  goalEnabled       Boolean  @default(false) @map("goal_enabled")
  updatedAt         DateTime @updatedAt @map("updated_at")

  user AppUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notification_settings")
}

// Очередь уведомлений (для отложенной отправки)
model NotificationQueue {
  id           Int                     @id @default(autoincrement()) @map("notification_id")
  userId       Int                     @map("user_id")
  telegramId   BigInt                  @map("telegram_id")
  matchId      BigInt                  @map("match_id")
  scheduledAt  DateTime                @map("scheduled_at")
  sentAt       DateTime?               @map("sent_at")
  status       NotificationStatus      @default(PENDING)
  messageType  NotificationMessageType @map("message_type")
  errorMessage String?                 @map("error_message")
  retryCount   Int                     @default(0) @map("retry_count")
  createdAt    DateTime                @default(now()) @map("created_at")

  user  AppUser @relation(fields: [userId], references: [id], onDelete: Cascade)
  match Match   @relation(fields: [matchId], references: [id], onDelete: Cascade)

  @@unique([userId, matchId, messageType], map: "notification_queue_user_match_type_unique")
  @@index([status, scheduledAt], map: "notification_queue_status_scheduled_idx")
  @@index([userId], map: "notification_queue_user_idx")
  @@index([matchId], map: "notification_queue_match_idx")
  @@map("notification_queue")
}

enum NotificationStatus {
  PENDING
  SENT
  FAILED
  CANCELLED
}

enum NotificationMessageType {
  MATCH_REMINDER
  MATCH_STARTED
  MATCH_FINISHED
  GOAL_SCORED
}

// =================== ЭКСПРЕСС-ПРОГНОЗЫ ===================

// Статус экспресс-прогноза
enum ExpressStatus {
  PENDING     // Ожидает расчёта
  WON         // Все события угаданы
  LOST        // Хотя бы одно не угадано
  CANCELLED   // Отменён (матч отменён)
  VOID        // Аннулирован
}

// Экспресс-прогноз (комбинированная ставка)
model ExpressBet {
  id           BigInt        @id @default(autoincrement()) @map("express_bet_id")
  userId       Int           @map("user_id")
  status       ExpressStatus @default(PENDING)
  multiplier   Decimal       @default(1.0) @map("multiplier") @db.Decimal(4, 2)
  basePoints   Int           @map("base_points")
  scoreAwarded Int?          @map("score_awarded")
  createdAt    DateTime      @default(now()) @map("created_at")
  resolvedAt   DateTime?     @map("resolved_at")

  items   ExpressBetItem[]
  appUser AppUser          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, status], map: "express_bet_user_status_idx")
  @@index([status, createdAt], map: "express_bet_status_created_idx")
  @@map("express_bet")
}

// Элемент экспресса (одно событие в комбинации)
model ExpressBetItem {
  id         BigInt                @id @default(autoincrement()) @map("express_bet_item_id")
  expressId  BigInt                @map("express_id")
  templateId BigInt                @map("template_id")
  selection  String
  status     PredictionEntryStatus @default(PENDING)
  basePoints Int                   @map("base_points")
  resolvedAt DateTime?             @map("resolved_at")

  express  ExpressBet         @relation(fields: [expressId], references: [id], onDelete: Cascade)
  template PredictionTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@unique([expressId, templateId], map: "express_item_unique")
  @@index([expressId], map: "express_item_express_idx")
  @@index([templateId, status], map: "express_item_template_status_idx")
  @@map("express_bet_item")
}

// Агрегированное время просмотра трансляций для достижений
model UserBroadcastWatchTime {
  userId        Int      @id @map("user_id")
  totalSeconds  Int      @default(0) @map("total_seconds")
  lastUpdatedAt DateTime @updatedAt @map("last_updated_at")
  appUser       AppUser  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_broadcast_watch_time")
}
